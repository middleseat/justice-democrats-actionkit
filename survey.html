{% extends "./wrapper.html" %}
{% load actionkit_tags %}

{% block content %}

{% load_remember_me %}

<form class="ak-form" name="act" method="POST" action="/act/" accept-charset="utf-8">
    <input type="hidden" name="page" value="{{ page.name }}">

    <div class="ak-grid-row">
        <div class="ak-grid-col ak-grid-col-12-of-12">
            <h2>{{ page.title }}</h2>

            <div class="ak-mobile-padding ak-text-expander">
                {% include_tmpl form.introduction_text %}
            </div>
            <a href="#" class="ak-read-more ak-mobile" data-lines="25">Read more</a>
        </div>
    </div>

    <div class="ak-grid-row">
        <div class="ak-grid-col ak-grid-col-4-of-12">
            
            {% if page.custom_fields.featured_image %}
            <img class="ak-featured-img" src="{{page.custom_fields.featured_image}}">
            {% endif %}
            
            <div id="survey-contact" class="ak-styled-fields {{templateset.custom_fields.field_labels_class|default:"ak-labels-overlaid"}} {{templateset.custom_fields.field_errors_class|default:"ak-errs-below"}}">
                {% include "./user_form_wrapper.html" %}
            </div>
            
            {% include "./progress_meter.html" %}
            
        </div>
        <div id="ak-survey-questions" class="ak-grid-col ak-grid-col-8-of-12">
            <div class="ak-field-box ak-field-box-padded ak-styled-fields ak-labels-above {{templateset.custom_fields.field_errors_class|default:"ak-errs-above"}}">

                {% autoescape off %}
                    {% for question in form.surveyquestion_set.all %}
                    <div>
                        <label class="ak-survey-question-label">
                            {{ question.question_label }}
                        </label>
                        {{ question.input_html }}
                    </div>
                    {% endfor %}
                {% endautoescape %}
				<div class="clear"></div>

                <button type="submit" class="ak-submit-button">{% if page.custom_fields.submit_button_name %}{{ page.custom_fields.submit_button_name }}{% else %}Submit Survey{% endif %}</button>
            </div>
        </div>

    </div>
</form>

<script>

$(window).load( function() {
    $("#id_action_event_id").closest('.ak-err-above').hide();
});

</script>


<script>
  function show (el) {
    el.style.display = 'block';
  }
  function hide (el) {
    el.style.display = 'none';
  }
  function toggle (el) {
    if (el.style.display == 'none') {
      el.style.display = 'block';
    } else {
      el.style.display = 'none';
    }
  }
  function showHiddenContent (ev) {
    var el = document.querySelector('#vol-events');
    var action = el.getAttribute('data-action');
    if (action == 'show') {
      show(el)
    } else if (action == 'hide') {
      hide(el)
    } else {
      toggle(el)
    }
  }
  function toggleTarget (ev) {
    ev.preventDefault();
    var el = ev.target
    var targetId = el.getAttribute('data-target')
    var toggleAll = el.getAttribute('data-all')
    if (!toggleAll && el.href != undefined) {
      toggleAll = el.parentNode.getAttribute('data-all')
    }
    var target = document.querySelector('#' + targetId)
    if (target) toggle(target)
    if (toggleAll) {
      var closable = document.querySelectorAll('.closable')
      closable.forEach(el => {
        hide(el)
      })
    }
  }
  function attachListeners() {
    var buttons = Array.from(document.querySelectorAll('.show-events'));
    buttons.forEach(function (button) {
      button.addEventListener('click', showHiddenContent);
    })
    var togglers = Array.from(document.querySelectorAll('.toggler'));
    togglers.forEach(function (button) {
      button.addEventListener('click', toggleTarget)
    });
  }
  attachListeners()
</script>


{% endblock %}
